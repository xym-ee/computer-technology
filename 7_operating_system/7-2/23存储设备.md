---
sort: 23
---
# 存储设备原理

操作系统是资源的管理者。

我们使用计算机，是通过IO设备来使用。所以也需要对IO做出合适的抽象。

RAM 是断电丢失的，我们想要在断电时保存状态机的状态。

这就有了存储当前状态的需求。操作系统是状态机，这些状态是存在于物理世界的，概念上的状态机的状态在物理世界有正事的对应。对于存储状态的需求：
- 可以寻址，通过地址找到这些状态
- 访问速度尽可能快
  - 甚至为了快，不惜断电丢失(这个并不是必须的，可以造出断电不丢失的计算机)
  - 


```note
如果一个 flash 可以用并行总线访问，那完全可以用来存放程序执行的中间运算数据。

但是 RAM 的速度要比 flash 快的多的多的多。断电丢失也是无奈之举，妥协方案。

```


早期的计算机并不适用电路来存储数据。用机械波的方式，delay line。再后来，磁芯内存，Magnetic core，所以代码报错、存储错误会提示 core dump，这种存储器接近今天的 DRAM 了，这种存储器有机械运动，所以注定速度快不起来。

不但速度快，我们还想要有持久的存储，此外如果发生了 crash，RAM和reg的东西没有了，但是持久化存储的数据不变。除了有限的 “当前状态”丢失，我们希望更大、更多的数据能 “留下来” (并且被操作系统有效地管理起来)。

这就是操作系统里持久化的问题。

持久化的第一课，持久存储介质。

存储介质是一切文件的基础。存储介质在逻辑上就是一个 bit/byte array，但是呢，根据局部性原理，我们按快读写，可以降低成本加快速度，比如 512Byte 4kB 2MB 这样的块。

存储介质评价方法：价格、容量、速度、可靠性。

现在个人PC用的存储设备，也是这些指标经过妥协的结果。

## 存储介质：磁

用磁实现持久化相对来说还是比较容易的。

比较早的存储介质，磁带，magnetic tape。
- 非常便宜，容量巨大，用于重要数据冷备份。

磁鼓 magnetic drum
- 用旋转的二维平面存储数据。读写延迟不会超过旋转周期。

磁盘 hard disk
- 价格低，容量高，顺序读取还行，随机读取勉强也能做。现在是计算机系统的主力数据存储设备。

为了读写一个扇区，读写头要到对应的磁道。

也有一些算法，比如“电梯”调度算法。早期这些算法是操作系统做的，但是现代HDD都有很好的firmware管理磁盘IO调用(磁盘里面的操作系统)。

HDD 上也有 CPU ，甚至有缓存，对于操作系统来说，现在完全不必理会磁盘的细节。一些调度读优先，写的话，晚一点也行。现在的操作系统已经不自作聪明去管这些了，因为磁盘里的操作系统了解自己的全部。

上个时代流行的设备：软盘。用来搬数据。现在有网盘，U盘。软盘的思路是把盘片和读写磁头分开。所以一个软盘就是一个磁片。今天的应用场景：博物馆。

## 存储介质：坑

最早，追溯到纸带机

CD，这上面是真有坑的。一个完美的反射面，挖坑使得反射光线能力下降，这就区分出01了。一个CD700MB，DVD4.7G，Blue ray 100GB 巨大的容量。然而只能读不能写。当然也可以复杂的做到，但是多方面综合考虑，不划算。

光盘复制超级快，压盘复制。顺序读写速度高。

## 电

- flash memory 。几乎全是优点。价格低 大规模集成电路，容量大，读写速度快，淘汰了旧的SATA，新的NVMe接口


USB flash disk，1999年但是，很快取代了软件。
