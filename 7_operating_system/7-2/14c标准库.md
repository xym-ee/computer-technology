---
sort: 14
---
# C 标准库实现

shell 系统调用，在往前走一步。

操作系统有内核，对外提供的 api 为 syscall，所有的程序都可以直接使用 syscall，其中有个特别重要的程序为 shell。shell 为其他应用程序提供了框架或者说环境，自己写的程序可以用管道连接起来，或者在图形化的shell里打开一个应用程序。

这部分来关注应用程序来怎么写。我们确实可以不用任何库函数实现一个应用，但是现在没有人这么干，都会有依赖一些库。

库也是构造操作系统的要素。

如何在系统调用上垢面程序能够普遍能用的库？

最基础、常用的 libc，c 语言标注库。

上大学的一个程序里就用到了 `stdio.h` 里的 `printf` 。

为什么需要 libc ？不借助任何库函数编程是可以的，但是需要我们把常见功能做一层封装，比如说内存的分配和回收。

此外还有任何程序都会用得上的定义，比如
- stddef.h - size_t
- stdint.h - int32_t, uint64_t
- stdbool.h - bool, true, false

现在我们有的，系统调用和C语言，如何一层一层把我们的易用的编程世界构建起来。

首先要扩充一些标准类型里和机器相关的定义，如 int 类型，`sizeof(int)` 是和编译器相关的，这是移植性的一个很大障碍。我们希望一套程序可以在32或64bit机器上运行。

前面例子的库就是在做这个事情。

syscall 还用到了 stdarg.h 参数列表。


然后系统调用也要更好用一些。

系统调用是操作系统 “紧凑” 的最小接口。并不是所有系统调用都像 fork 一样可以直接使用。

此外libc也会封装纯粹的计算，比如 `memset` 函数，




