---
sort: 3
---
# Python 建模操作系统


在理解了 “软件 (应用)” 和 “硬件 (计算机)” 之后，操作系统就是直接运行在计算机硬件上的程序，它提供了应用程序执行的支撑和一组 API (系统调用)：操作系统内核被加载后，拥有完整计算机的控制权限，包括中断和 I/O 设备，因此可以构造出多个应用程序同时执行的 “假象”。

- 应用程序来看，操作系统就是一条 syscall 指令
- 硬件来看，操作系统就是一个 C 程序，我们能从cpureset开始运行状态机，加载自己的代码，操作系统iu能运行起来

当我们一直说程序是状态机的时候，我们有没有可能，把这个状态机画出来。

## 操作系统的状态机模型

gdb，每一步都能看到状态，然后往前走一步。

存在的问题是，状态太多了。当我们想去看初始状态，都要去查很厚的手册。

所以理论上做理解没有任何问题，实际也是这样的。但是真的要画状态机，并不容易。

所以需要简化。
- 操作系统里有这种工具，strace，把状态简化成操作系统和应用软件的边界。


把汇编状态机简化成C的状态机，C是高级汇编，我们可以用更高级的语言模拟实现这个行为。

我们只关心纯粹的计算和系统调用。

## 建模

四个 “系统调用” API
- choose(xs): 返回 xs 中的一个随机选项
- write(s): 输出字符串 s
- spawn(fn): 创建一个可运行的状态机 fn
- sched(): 随机切换到任意状态机执行


除此之外，所有的代码都是确定 (deterministic) 的纯粹计算

允许使用 list, dict 等数据结构
