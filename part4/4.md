---
sort: 4
---
# 整数运算实现

## 4.1 整数乘法运算实现

高级语言里两个n位整数相乘得到的结果通常也是一个n位整数，即只取结果2n位里的低n位
```c
int a,b,x;

x = a*b;
```

因此，C语言里，参加运算的两个操作数的类型和结果的类型应该一样，如果不一样则会先转换为一样的结果。

机器内部运算，$$ x^2 \ge 0 $$ 不一定成立。如果x是带符号整数不一定成立，如果是浮点数，那么成立。

```c
#include <stdio.h>

typedef unsigned char   uint8_t;
typedef signed char     int8_t;

int main()
{
    int8_t m = 15;
    int8_t n = 10;

    int8_t k1 = m * n;

    printf("m*n: %d (%x %b)\n",k1,k1,k1);

    return 0;
}
```
输出结果为-106

只取了低8位作为结果，溢出了。

```c
int mul(int x,int y)
{
    int z = x*y;
    return z;
}
```

如何用程序判断一个乘法运算结果是否正确呢？`!x || z/x == y`，算出来还可以除回去，就说明这个运算结果是正确的。

编译器来判断的话，是看最高位是否为全0或1。

如果只用乘法只用低位的话，用补码作运算，有无符号数的运算在机器层次没什么不同，那么可以只用低位作为结果，只用一个无符号乘法器就行，但是这样的话就无法在编译器层次判断数据溢出了，只能在程序里判断是否溢出。

乘法器硬件不判断溢出，只是把结果存其来供软件使用，如果程序里不进行溢出判断，那么可能就会有一些溢出问题。

对于加减运算，不论有无符号，可以使用同样的指令，但是有无符号乘法的指令要分开。

乘法指令的操作数长度为n，乘积长度为2n。

