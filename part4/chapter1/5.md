---
sort: 5
---
# 程序的表示转换和链接


高级语言程序中的运算是通过指令来完成的，参与运算的变量或常量就是指令中的操作数，所以了解了运算的底层逻辑以后，来进一步了解指令。

目前主流计算机都是intel架构。

## 5.1 

### 5.1.1 程序和指令的关系

还是得看编程模型，硬件结构，第一章的东西。

“存储程序”的工作方式。

程序由指令组成：
- 程序在执行之前，数据和指令存放在存储器里，指令和数据都有地址，指令由OP、ADDR字段组成，(操作码字段，地址字段)，程序的起始地址放在PC(程序计数器)里。
- 开始执行程序
  - 1.根据PC取得指令
  - 2.指令译码
  - 3.取操作数
  - 4.指令执行
  - 5.回写结果
  - 6.修改PC的值

指令和数据在形式上没有区别，都是01序列。指令执行时，指令和数据从存储器挪动到CPU，指令放在指令寄存器里，数据放在通用寄存器里。

指令中需要给出的信息：
- 操作性质(操作码)
- 源操作数1；源操作数2(可选)。(立即数，寄存器编号，存储器地址)
- 目的操作数地址(寄存器编号，存储地址)

存储地址的描述与操作数的数据结构有关

指令描述对谁干什么。操作数在指令里给出，就是个立即数，参考微机原理。

除了上面这些，再来回顾一下不同层次语言之间的等价转换关系。

高级语言无法直接执行，要用**编译程序**编译位汇编语言程序，再用**汇编程序**转换成机器指令，机器指令就是01序列，可以直接在硬件上执行，可以被机器理解。机器指令实际上是控制信号，控制数字电路动作。任何高级语言最终是通过执行若干条指令来完成的。

软件和硬件的交界面有个接口，这个接口就是**指令系统**，或者叫指令集体系结构，最关键的就是指令。

指令有微指令、机器指令、伪(宏)指令之分

这里讲的指令都是机器指令。微指令是硬件范畴，是微程序级指令，“微过程”。伪指令之由若干机器指令组成的指令序列，相当于子程序，属于软件范畴。汇编指令是机器指令的汇编表示形式，即符号表示，机器指令和汇编指令一一对应，都和机器结构有关，都是机器级指令。

机器指令是01序列，由若干字段组成

```
mov [bx+di-6], cl
```

```
movb %cl, -6(%bx, %di)
```

汇编指令来表示机器指令，可能有不同格式，比如intel格式，或AT&T格式

指令的功能可以用寄存器传送语言来描述(Register Transfer Language)

```
M[ R[bx] + R[di] - 6 ] ← R[cl]
```

mov,bx,movb都是助记符

最后再回顾一下高级语言转换为机器代码的过程。

[hello.c]预处理[hello.i]编译[hello.s]汇编[hello.o]链接[hello]

- 预处理：高级语言源程序中#开头的文本处理
- 编译：生成汇编语言程序
- 汇编：生成机器语言文件
- 链接：生成最终的可执行文件


### 5.1.2 目标代码和ISA

gcc使用举例

```bash
# 基本使用
gcc -O1 main.c test.c -o test

```







